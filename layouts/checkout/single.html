{{ define "main" }}

<!-- Top Countdown Banner -->
<div style="background: linear-gradient(to right, #fef3c7, #fde68a); padding: 1rem; text-align: center; border-bottom: 2px solid #f59e0b;">
  <p style="margin: 0; font-size: 1rem; color: #78350f;">
    üî• <strong>The FengShui Bracelet is in high demand and inventory is limited.</strong> We have reserved your order for the next <span id="countdown-timer" style="color: #dc2626; font-weight: bold;">11:23</span> minutes.
  </p>
</div>

<!-- Coupon Banner -->
<div style="background: white; padding: 1.5rem; border: 3px dashed #3FA026; border-radius: 8px; margin: 1rem auto; max-width: 1200px;">
  <div style="display: flex; align-items: center; gap: 2rem; justify-content: center; flex-wrap: wrap;">
    <div style="background: #dc2626; color: white; width: 120px; height: 120px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;">
      <div style="position: absolute; top: 10px; font-size: 1.5rem;">‚≠ê‚≠ê‚≠ê</div>
      <div style="font-size: 2.5rem; font-weight: bold; line-height: 1;">50%</div>
      <div style="font-size: 1rem; font-weight: bold;">DISCOUNT</div>
    </div>
    <div style="text-align: center;">
      <h2 style="color: #3FA026; font-size: 1.75rem; margin: 0 0 0.5rem 0; font-weight: bold;">Exclusive 50% OFF + FREE Delivery</h2>
      <p style="margin: 0; font-size: 1.1rem; color: #059669;">Your Coupon <strong>(S67K5UE)</strong> has been applied > <span style="font-weight: bold;">50% Off</span></p>
      <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #dc2626; font-weight: bold;">Do NOT leave this page to avoid losing the discount</p>
    </div>
  </div>
</div>

<!-- Special Offer Banner -->
<div style="background: linear-gradient(to right, #22c55e, #16a34a); color: white; padding: 1rem; text-align: center; margin-bottom: 2rem;">
  <p style="margin: 0; font-size: 1.1rem; font-weight: bold;">‚≠ê SPECIAL OFFER - Get A FREE FengShui Protection Bag With Every Order [LIMITED STOCK]</p>
</div>

<div class="checkout-container" style="max-width: 1200px; margin: 0 auto; padding: 2rem;">

  <div class="checkout-content" style="display: grid; grid-template-columns: 45% 55%; gap: 2rem;">

    <!-- Left Column: Product Selection -->
    <div class="product-section">

      <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; font-weight: bold;">STEP 1: SELECT ORDER QUANTITY</h2>

      <!-- Pricing Table -->
      <div class="pricing-table" style="background: white; border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 2rem;">
        <!-- Header -->
        <div style="display: flex; background: #f3f4f6; border-bottom: 2px solid #e5e7eb; font-weight: bold; padding: 0.75rem 1rem;">
          <div style="flex: 1;">Item</div>
          <div style="width: 100px; text-align: right;">Price</div>
        </div>

        <!-- Plan Options -->
        <div style="padding: 0.5rem;">

        {{ range $key, $value := .Params.plans }}
        {{ $isPopular := eq $key "triple" }}
        <div class="plan-option"
             data-plan="{{ $key }}"
             style="background: {{ if $isPopular }}#fef3c7{{ else }}#f3f4f6{{ end }}; padding: 1rem; margin-bottom: 0.75rem; border-radius: 4px; cursor: pointer; position: relative;">
          <label style="display: flex; align-items: flex-start; cursor: pointer; width: 100%;">
            <input type="radio" name="plan" value="{{ $key }}"
                   {{ if $isPopular }}checked{{ end }}
                   style="margin-right: 1rem; margin-top: 0.25rem; width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
            <div style="flex: 1; display: flex; justify-content: space-between; align-items: flex-start;">
              <div style="flex: 1;">
                <div style="font-size: 1rem; margin-bottom: 0.25rem;">
                  {{ $value.items_count }} x FengShui Bracelet{{ if gt $value.items_count 1 }}{{ if eq $value.items_count 2 }} + 1 FREE{{ else }} + {{ sub $value.items_count 1 }} FREE{{ end }} ({{ if eq $key "single" }}50{{ else if eq $key "double" }}67{{ else }}70{{ end }}% Discount ${{ div $value.price $value.items_count }} each!){{ else }} (50% Discount){{ end }}
                </div>
                {{ if $isPopular }}
                <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #dc2626; color: white; padding: 0.125rem 0.75rem; border-radius: 12px; font-size: 0.7rem; font-weight: bold; white-space: nowrap;">MOST POPULAR!</div>
                {{ end }}
              </div>
              <div style="text-align: right; margin-left: 1rem;">
                <div style="text-decoration: line-through; color: #999; font-size: 0.85rem;">${{ $value.original_price }}</div>
                <div style="color: #22c55e; font-weight: bold; font-size: 1.25rem;">${{ $value.price }}</div>
              </div>
            </div>
          </label>
        </div>
        {{ end }}
        </div>
      </div>

      <!-- Payment Form -->
      <div class="payment-form">

        <div style="margin-bottom: 2rem;">
          <h3 style="font-size: 1.25rem; margin-bottom: 1rem; font-weight: bold;">STEP 2: COMPLETE YOUR ORDER</h3>

          <!-- Stripe Embedded Checkout will be mounted here -->
          <!-- It handles: Email, Shipping Address, Payment Method, and Submit Button -->
          <div id="checkout-container">
            <!-- Loading state will be shown here initially -->
          </div>
        </div>

        <!-- Security Notice -->
        <div style="text-align: center; margin-top: 1.5rem; color: #666; font-size: 0.875rem;">
          <p>üîí Secure payment powered by Stripe</p>
          <p>Your payment information is encrypted and secure</p>
        </div>
      </div>

    </div>
  </div>

</div>

<!-- Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

<!-- Pass configuration to JavaScript BEFORE loading checkout.js -->
<script>
  window.checkoutConfig = {
    currency: '{{ lower .Params.currency }}',
    productName: '{{ .Params.product_name }}',
    workerUrl: '{{ site.Params.stripe.worker_url }}',
    publishableKey: '{{ site.Params.stripe.publishable_key }}',
    plans: {
      {{ range $key, $value := .Params.plans }}
      {{ $key }}: {
        name: '{{ $value.name }}',
        description: '{{ $value.description }}',
        price: {{ $value.price }},
        original_price: {{ $value.original_price }},
        quantity: {{ $value.quantity }},
        price_id: '{{ $value.price_id }}',
        savings: {{ $value.savings }},
        badge: '{{ $value.badge }}',
        features: [
          {{ range $value.features }}
          '{{ . }}',
          {{ end }}
        ]
      },
      {{ end }}
    }
  };
</script>

<!-- Load checkout.js AFTER configuration -->
<script src="/js/checkout.js?v={{ now.Unix }}"></script>

<!-- Responsive CSS -->
<style>
@media (max-width: 768px) {
  .checkout-content {
    grid-template-columns: 1fr !important;
  }
  .product-section {
    order: 2;
  }
  .order-section {
    order: 1;
  }
  /* Mobile navigation */
  .checkout-container {
    padding: 1rem !important;
  }
}

#submit-button:hover {
  background-color: #5ED54B !important;
}

#submit-button:disabled {
  background-color: #9ca3af !important;
  cursor: not-allowed !important;
}

/* Plan selection styles */
.plan-option:hover {
  border-color: #3FA026 !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(63, 160, 38, 0.15);
}

.plan-option input[type="radio"]:checked ~ div {
  color: #000;
}

.plan-option input[type="radio"]:checked {
  accent-color: #3FA026;
}

/* Popular plan highlight */
.plan-popular {
  position: relative;
}

.plan-popular::before {
  content: "‚≠ê MOST POPULAR";
  position: absolute;
  top: -10px;
  right: 10px;
  background: #dc2626;
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: bold;
  z-index: 1;
}
</style>

{{ end }}
